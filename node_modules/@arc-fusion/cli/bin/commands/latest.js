'use strict'

const {
  name: packageName,
  version: installedVersion
} = require('../../package.json')

const { exec } = require('../utils/promises')

async function getLatest () {
  const { stdout: latestVersion } = await exec(`npm view ${packageName} version`)
  return latestVersion.trim()
}

module.exports = async () => {
  const latestVersion = await getLatest()
  if (latestVersion !== installedVersion) {
    const installedPadded = `${installedVersion}`.padStart(12, ' ')
    const latestPadded = `${latestVersion}`.padStart(12, ' ')
    console.warn(`
  -----------------------------------------------------
  |  You are using Fusion CLI version:  ${installedPadded}  |
  |  The latest Fusion CLI version is:  ${latestPadded}  |
  |                                                   |
  |  Please consider updating by running:             |
  |  > npm install --save-dev @arc-fusion/cli@latest  |
  -----------------------------------------------------
  `)
  }
}

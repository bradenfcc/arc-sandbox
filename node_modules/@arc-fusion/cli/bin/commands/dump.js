'use strict'

const spawn = require('../utils/spawn')

const {
  dockerList,
  run
} = require('../utils/docker')

async function dump () {
  const mongoProcess = (await dockerList('ps'))
    .find((ps) => ps.includes(':27017->'))

  if (mongoProcess) {
    const mongoProcessId = mongoProcess.split(/\s+/g)[0]
    return spawn('docker', ['exec', mongoProcessId, './dump.sh'], { stdio: 'inherit' })
  } else {
    return run('dump')
  }
}

module.exports = dump

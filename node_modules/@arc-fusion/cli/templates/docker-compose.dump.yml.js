'use strict'

const os = require('os')

const isWindows = /^win/i.test(os.platform())

module.exports = async ({ REPO_NAME }) =>
  ({
    version: '3',

    services: {
      dump: {
        image: 'washpost/mongo-vandelay',
        command: './dump.sh',
        container_name: 'fusion-dump',
        environment: {
          DB_NAME: `\${DB_NAME:-${REPO_NAME}}`,
          MONGO_URL: `mongodb://data:27017/\${DB_NAME:-${REPO_NAME}}`,
          SYNC: (isWindows) ? 'true' : ''
        },
        network_mode: 'none',
        volumes: [
          '../data/db:/data/db:rw',
          '../data/dumps:/data/dumps:rw'
        ]
      }
    }
  })

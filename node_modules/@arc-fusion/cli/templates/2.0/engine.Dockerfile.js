'use strict'

const path = require('path')

const { dirExists } = require('../../bin/utils/promises')

module.exports = async ({ PROJECT_ROOT }) => {
  const hasScripts = await dirExists(path.join(PROJECT_ROOT, 'scripts'))

  return `
ARG FUSION_RELEASE=latest
FROM washpost/fusion-engine:\${FUSION_RELEASE}

COPY ./package*.json ./bundle/
${hasScripts ? 'COPY ./scripts/ ./bundle/scripts/' : ''}
RUN cd ./bundle && npm install --production --unsafe-perm
`
}
